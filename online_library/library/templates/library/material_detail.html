{% extends 'library/base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-lg p-4">
        <h2 class="text-center mb-3">{{ material.title }}</h2>

        <div class="row">
            <div class="col-md-8">
                <p><strong>Category:</strong> {{ material.category }}</p>
                <p><strong>Description:</strong> {{ material.description }}</p>
                <p><strong>Author:</strong> {{ material.author }}</p>
                <p><strong>Release Date:</strong> {{ material.release_date }}</p>
                <p><strong>Uploaded by:</strong> {{ material.uploaded_by.username }}</p>
                <p><strong>Upload Date:</strong> {{ material.upload_date }}</p>
            </div>
            <div class="col-md-4 text-end">
                {% if user.is_authenticated %}
                    <a href="{% url 'download_material' material.id %}" class="btn btn-primary">Download</a>
                {% else %}
                    <p><a href="{% url 'login' %}">Log in</a> to download this material.</p>
                {% endif %}
                {% if user == material.uploaded_by or user.is_superuser %}
                    <form method="POST" action="{% url 'delete_material' material.id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger"
                                onclick="return confirm('Are you sure you want to delete this material?');">
                            Delete
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>

        <hr>

        <h3 class="mt-4">File Preview</h3>
        <div class="border p-3 rounded bg-light">
            {% with file_ext=material.file.url|lower|slice:'-4:' %}
                {% if file_ext == ".pdf" %}
                    <iframe src="{{ material.file.url }}" width="100%" height="500px" class="border"></iframe>
                {% elif file_ext == ".mp4" %}
                    <video width="100%" controls class="rounded shadow">
                        <source src="{{ material.file.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                {% elif file_ext == ".jpg" or file_ext == ".png" or file_ext == ".jfif" %}
                    <img src="{{ material.file.url }}" class="img-fluid rounded shadow" alt="Uploaded Image" />
                {% elif file_ext == ".txt" %}
                    <iframe src="{% url 'txt_preview' material.id %}" width="100%" height="400px" class="border"></iframe>
                {% elif file_ext == ".mp3" or file_ext == ".wav" or file_ext == ".ogg" %}
                    <h3 class="mt-4">Audio Preview</h3>
                    <audio controls class="w-100">
                        <source src="{{ material.file.url }}" type="audio/{{ file_ext|slice:'1:' }}">
                        Your browser does not support the audio element.
                    </audio>
                {% else %}
                    <p><a href="{{ material.file.url }}" class="btn btn-warning">Download File</a></p>
                {% endif %}
            {% endwith %}
        </div>
    </div>
</div>
{% endblock %}
